{% load static %}
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'CSS/graficos.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/navbar.css' %}">
    <link rel="icon" type="image/png" href="{% static 'Img/logo_san_bernardo2.png' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.iconify.design/iconify-icon/2.1.0/iconify-icon.min.js"></script>
    <script src="https://kit.fontawesome.com/6a284d15f6.js" crossorigin="anonymous"></script>

    <title>Graficos en San Bernardo</title>
</head>

<body>

    <nav id="navbar" class="navbar">

        <div class="logo_navbar">
            <img src="{% static 'Img/logo_navbar.jpg' %}" class="logo-navbar-img" alt="">
        </div>

        <h2 class="titulo-pagina">Seguridad Ciudadana "San Bernardo"</h2>

        <!-- Bot√≥n del men√∫ Usuario -->
        <div class="dropdown2">
            <i id="boton-usuario" role="button" class="fa-solid fa-user dropdown-toggle2" onclick="toggleDropdown2()">
                <div class="dropdown-menu2" id="dropdownUsuario">

                    <!-- ‚úÖ Mostrar informaci√≥n del usuario si est√° logueado -->
                    {% if user.is_authenticated %}
                    <div class="user-info">
                        <strong>{{ user.nombre_usuario }} {{ user.apellido_pat_usuario }}</strong>
                        <small>{{ user.id_rol.nombre_rol }}</small>
                    </div>
                    <div class="dropdown-divider"></div>
                    {% endif %}
                    <a href="{% url 'perfil_usuario' %}" class="dropdown-item2">
                        <i class="fa-solid fa-user"></i> Perfil
                    </a>
                    <a href="{% url 'index' %}" class="dropdown-item2">
                        <i class="fa-solid fa-map"></i> Mapa
                    </a>
                    <a href="" class="dropdown-item2">
                        <i class="fa-solid fa-list"></i> Historial de Alertas
                    </a>
                    <a href="{% url 'denuncias_dashboard' %}" class="dropdown-item2">
                        <i class="fa-solid fa-chart-pie"></i> Graficos
                    </a>
                    <a href="{% url 'Admin' %}" class="dropdown-item2">
                        <i class="fa-solid fa-list"></i> Panel Administraci√≥n
                    </a>
                    <a href="{% url 'logout' %}" class="dropdown-item2 logout-btn">
                        <i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesi√≥n
                    </a>
                </div>
            </i>
        </div>

    </nav>

    <div class="graficos-section">
        <div class="container-fluid py-4 dashboard-wrapper">

            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="page-title mb-1">Dashboard de Denuncias</h1>
                <p class="page-subtitle mb-0">Estad√≠sticas generales de las denuncias registradas</p>
            </div>

            <!-- FILA 1: ESTADO / FAMILIA / PRIORIDAD / TOP REQUERIMIENTOS -->
            <div class="row g-4 mb-4">
                <!-- Denuncias por Estado -->
                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h5>Denuncias por Estado</h5>
                            <span class="badge total-badge" id="badge-total-estado">0</span>
                        </div>
                        <div class="dashboard-card-body">
                            <h6 class="chart-subtitle">Distribuci√≥n por Estado</h6>
                            <div class="chart-wrapper chart-wrapper-estado">
                                <canvas id="denunciasPorEstadoChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Denuncias por Familia -->
                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h5>Denuncias por Familia</h5>
                            <span class="badge total-badge" id="badge-total-familia">0</span>
                        </div>
                        <div class="dashboard-card-body">
                            <h6 class="chart-subtitle">Top Familias de Denuncia</h6>
                            <div class="chart-wrapper">
                                <canvas id="denunciasPorFamiliaChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Denuncias por Prioridad -->
                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h5>Denuncias por Prioridad</h5>
                            <span class="badge total-badge" id="badge-total-clasificacion">0</span>
                        </div>
                        <div class="dashboard-card-body">
                            <h6 class="chart-subtitle">Clasificaci√≥n de Requerimientos</h6>
                            <div class="chart-wrapper">
                                <canvas id="denunciasPorClasificacionChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- üÜï Top 5 Requerimientos -->
                <div class="col-lg-3 col-md-6">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h5>Top 5 Requerimientos</h5>
                            <span class="badge total-badge" id="badge-total-requerimiento">0</span>
                        </div>
                        <div class="dashboard-card-body">
                            <h6 class="chart-subtitle">Mayor frecuencia</h6>
                            <div class="chart-wrapper">
                                <canvas id="topRequerimientosChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FILA 2: POR MES + TOP USUARIOS -->
            <div class="row g-4">
                <!-- Denuncias por Mes -->
                <div class="col-lg-8 col-md-7">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h5>Denuncias por Mes (√∫ltimos 12 meses)</h5>
                            <span class="badge total-badge" id="badge-total-mes">0</span>
                        </div>
                        <div class="dashboard-card-body">
                            <h6 class="chart-subtitle">Tendencia temporal</h6>
                            <div class="chart-wrapper">
                                <canvas id="denunciasPorMesChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Top Usuarios -->
                <div class="col-lg-4 col-md-5">
                    <div class="dashboard-card">
                        <div class="dashboard-card-header">
                            <h5>Top 10 Usuarios</h5>
                            <span class="badge total-badge" id="badge-total-usuario">0</span>
                        </div>
                        <div class="dashboard-card-body">
                            <h6 class="chart-subtitle">Denuncias registradas por usuario</h6>
                            <div class="chart-wrapper">
                                <canvas id="denunciasPorUsuarioChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Plugin para mostrar valores en los gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <!-- JS del Dashboard -->
    <script src="{% static 'JavaScript/graficos.js' %}"></script>
    <script src="{% static 'JavaScript/redirecciones.js' %}"></script>

</body>

</html>